#!/usr/bin/env php
<?php

declare(strict_types=1);

namespace webignition\BasilRunner\Bin;

use Symfony\Component\Console\Application;
use webignition\BasilRunner\ApplicationConfiguration;
use webignition\BasilRunner\Command\RunCommand;
use webignition\BasilRunner\Kernel;

$autoloadPath = __DIR__ . '/../vendor/autoload.php';

if (!file_exists($autoloadPath)) {
    fwrite(
        STDERR,
        sprintf(
                'Vendor autoloader not found at "%s".' . PHP_EOL . PHP_EOL .
                'Have you installed dependencies with composer?' . PHP_EOL . PHP_EOL,
                str_replace('/bin/..', '', $autoloadPath)
        )
    );

    exit(1);
}

require_once $autoloadPath;

$kernel = new Kernel('dev', true);
$kernel->boot();

$container = $kernel->getContainer();

/* @var Application $application */
$application = $container->get(Application::class);

/* @var ApplicationConfiguration $applicationConfiguration */
$applicationConfiguration = $container->get(ApplicationConfiguration::class);
$applicationConfiguration->configureApplication($application);

/* @var RunCommand $runCommand */
$runCommand = $container->get(RunCommand::class);
$application->setDefaultCommand($runCommand->getName());

$application->run();
